<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Earthquake Example</title>
  <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
  <style>
    html, body, #map { height: 100%; margin: 0; }
    .legend {
      position: absolute; bottom: 12px; left: 12px; background: #fff; padding: 8px 10px;
      border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,.15); font: 12px/1.3 system-ui, Arial, sans-serif;
    }
    .swatch { display:inline-block; width:12px; height:12px; margin-right:6px; border-radius:2px; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="legend">
    <div><span class="swatch" style="background:#2DC4B2"></span> mag &lt; 3.0</div>
    <div><span class="swatch" style="background:#3BB3C3"></span> 3.0–4.0</div>
    <div><span class="swatch" style="background:#669EC4"></span> 4.0–5.0</div>
    <div><span class="swatch" style="background:#8B88B6"></span> 5.0–6.0</div>
    <div><span class="swatch" style="background:#A2719B"></span> ≥ 6.0</div>
  </div>
  <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
  <script>
    const map = new maplibregl.Map({
      container: 'map',
      style: {
        version: 8,
        sources: {
          osm: {
            type: 'raster',
            tiles: [
              'https://a.tile.openstreetmap.org/{z}/{x}/{y}.png',
              'https://b.tile.openstreetmap.org/{z}/{x}/{y}.png',
              'https://c.tile.openstreetmap.org/{z}/{x}/{y}.png'
            ],
            tileSize: 256,
            attribution: '© OpenStreetMap contributors'
          }
        },
        layers: [{ id: 'osm', type: 'raster', source: 'osm' }]
      },
      center: [139.6917, 35.6895], // roughly Tokyo
      zoom: 3.8
    });

    map.on('load', async () => {
      const quakes = await (await fetch('assets/earthquakes.geojson')).json();

      map.addSource('quakes', { type: 'geojson', data: quakes });

      map.addLayer({
        id: 'quakes-circles',
        type: 'circle',
        source: 'quakes',
        paint: {
          'circle-color': [
            'step', ['get', 'mag'],
            '#2DC4B2', 3,
            '#3BB3C3', 4,
            '#669EC4', 5,
            '#8B88B6', 6,
            '#A2719B'
          ],
          'circle-radius': [
            'interpolate', ['linear'], ['get', 'mag'],
            2.5, 4, 5, 10, 7, 16
          ],
          'circle-opacity': 0.8,
          'circle-stroke-color': '#fff',
          'circle-stroke-width': 1
        }
      });

      // Simple popup
      map.on('click', 'quakes-circles', (e) => {
        const f = e.features[0];
        const { place, mag, time } = f.properties;
        new maplibregl.Popup()
          .setLngLat(e.lngLat)
          .setHTML(`<strong>M ${mag}</strong><br>${place || ''}<br>${new Date(time).toLocaleString()}`)
          .addTo(map);
      });

      map.on('mouseenter', 'quakes-circles', () => map.getCanvas().style.cursor = 'pointer');
      map.on('mouseleave', 'quakes-circles', () => map.getCanvas().style.cursor = '');
    });
  </script>
</body>
</html>